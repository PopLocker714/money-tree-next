(()=>{var e={};e.id=980,e.ids=[980],e.modules={87550:e=>{"use strict";e.exports=require("better-sqlite3")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},79551:e=>{"use strict";e.exports=require("url")},80652:e=>{e.exports={style:{fontFamily:"'Montserrat', 'Montserrat Fallback'",fontStyle:"normal"},className:"__className_0385ae"}},73395:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var s=r(70260),n=r(28203),a=r(25155),i=r.n(a),o=r(67292),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d=["",{children:["(shop)",{children:["catalog",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,80010)),"/home/jojo/Documents/money-tree-next/src/app/(shop)/catalog/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,34313)),"/home/jojo/Documents/money-tree-next/src/app/(shop)/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/home/jojo/Documents/money-tree-next/src/app/(shop)/catalog/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/(shop)/catalog/page",pathname:"/catalog",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},71461:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,59607,23)),Promise.resolve().then(r.t.bind(r,71066,23))},81733:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,28531,23)),Promise.resolve().then(r.t.bind(r,41902,23))},67084:(e,t,r)=>{"use strict";r.d(t,{b:()=>n});var s=r(29047);let n=async()=>(function(e){let t={};e.forEach(e=>{t[e.id]={...e,children:[]}});let r=[];return e.forEach(e=>{null===e.parentId?r.push(t[e.id]):t[e.parentId].children.push(t[e.id])}),r})(await s.A.query.$Categories.findMany())},80010:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m,metadata:()=>p});var s=r(62740),n=r(29047),a=r(12562);r(76301);var i=r(97128);function o({items:e}){return(0,s.jsx)("ul",{className:"pr-4",children:e.map(e=>(0,s.jsx)(i.A,{category:e,isRoot:!0},e.id))})}var l=r(67084);async function d(){let e=await (0,l.b)();return(0,s.jsx)("aside",{className:"py-4 max-w-72",children:(0,s.jsx)(o,{items:e})})}var c=r(48590),u=r(47579);let p={title:"Каталог",description:""};async function m({searchParams:e}){let t=(await e).category||"[]";Array.isArray(t)&&(t="[]");let r=JSON.parse(t),i=(r.length>0?await n.A.query.$Products.findMany({where:(0,u.Uo)((0,u.RV)(c.$Products.categoryId,r.map(e=>Number(e))),(0,u.eq)(c.$Products.isActive,!0))}):await n.A.query.$Products.findMany({where:(0,u.eq)(c.$Products.isActive,!0)})).map(e=>({cost:e.price||0,discount:e.discount||0,title:e.title,image:e.previewImage,id:e.id?.toString()||""}));return(0,s.jsx)("section",{className:"container",children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(d,{}),(0,s.jsx)("div",{className:"flex-1 py-6 pl-4",children:(0,s.jsx)("div",{className:"grid grid-cols-3 gap-4",children:i.map(e=>(0,s.jsx)(a.A,{...e},e.id))})})]})})}},97128:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,O:()=>i});var s=r(62740),n=r(59607),a=r.n(n);function i(e){let t=[e.id];if(e.children&&e.children.length>0)for(let r of e.children)t.push(...i(r));return t}function o({category:e,isRoot:t}){return(0,s.jsxs)("li",{className:t?"pb-1":"pl-4 border-l border-gray-300",children:[(0,s.jsx)(a(),{href:`/catalog?${new URLSearchParams({category:JSON.stringify(i(e))})}`,className:"link",children:e.name}),e.children&&e.children.length>0&&(0,s.jsx)("ul",{className:"ml-4",children:e.children.map(e=>(0,s.jsx)(o,{category:e,isRoot:!1},e.id))})]})}r(76301)},12562:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(62740),n=r(13673),a=r(35635),i=r(59607),o=r.n(i);r(76301);let l=function({cost:e=0,discount:t,id:r,image:i,title:l,className:d}){return(0,s.jsxs)(o(),{className:(0,n.A)("relative flex flex-col overflow-hidden max-w-[266px] rounded-3xl shadow-[0px_0px_16px_0_rgba(51,37,87,0.15)] transition-shadow hover:shadow-[0px_0px_16px_0_rgba(51,37,87,0.3)]",d),href:`/product/${r}`,children:[t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"absolute top-4 right-4 bg-red-500 text-white-100  text-sm font-medium p-[6px] rounded-full",children:"Распродажа"}),(0,s.jsxs)("span",{className:"absolute top-4 left-4  bg-red-500 text-white-100 text-sm font-medium p-[6px] rounded-full",children:[Math.floor(100-(e-t)/e*100),"%"]})]}):null,(0,s.jsx)(a.default,{className:"max-w-[266px] max-h-[235px]",alt:l,width:266,height:235,src:i||"https://placehold.co/266x235/000000/FFFFFF/png"}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("h3",{className:"text-base text-foreground mb-4",children:l}),t?(0,s.jsxs)("p",{className:"text-green-400 flex items-center text-xl w-fit rounded-xl py-3 px-6 bg-gray-100 ",children:[e-t,"₽ ",(0,s.jsxs)("span",{className:"line-through ml-1 text-gray-400 text-xs",children:[e,"₽"]})]}):(0,s.jsxs)("p",{className:"text-foreground flex text-xl w-fit rounded-xl py-3 px-6 bg-gray-100",children:[e,"₽"]})]})]},r)}},29047:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(86084),n=r(87550),a=r.n(n),i=r(48590);let o=new(a())(process.env.DB_FILE_NAME),l=(0,s.f)({client:o,schema:i})},48590:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$Categories:()=>d,$Products:()=>m,$Users:()=>l,CategoryRelations:()=>p,ProductRelations:()=>f,insertCategorySchema:()=>c,insertProductSchema:()=>h,selectCategorySchema:()=>u,selectProductSchema:()=>x});var s=r(23555),n=r(21300),a=r(47095),i=r(49190),o=r(78625);let l=(0,n.D)("users",{id:(0,a.Wh)().primaryKey({autoIncrement:!0}),email:(0,i.Qq)().notNull().unique(),password_hash:(0,i.Qq)().notNull(),salt:(0,i.Qq)().notNull()}),d=(0,n.D)("categories",{id:(0,a.Wh)().primaryKey({autoIncrement:!0}),name:(0,i.Qq)("name").notNull(),parentId:(0,a.nd)("parent_id").references(()=>d.id,{onDelete:"cascade"})}),c=(0,o.r)(d),u=(0,o.aJ)(d),p=(0,s.K1)(d,({one:e})=>({children:e(d,{fields:[d.parentId],references:[d.id]})})),m=(0,n.D)("products",{id:(0,a.nd)("id").primaryKey({autoIncrement:!0}),sku:(0,i.Qq)("sku").notNull().unique(),title:(0,i.Qq)("title").notNull(),description:(0,i.Qq)("description"),price:(0,a.nd)("price").notNull().default(0),discount:(0,a.nd)("discount").default(0),stock:(0,a.nd)("stock").notNull().default(0),previewImage:(0,i.Qq)("previewImage"),images:(0,i.Qq)("images").notNull().$default(()=>JSON.stringify([null,null,null,null,null])),categoryId:(0,a.nd)("category_id").references(()=>d.id,{onDelete:"set null"}),keywordsSearch:(0,i.Qq)("keywordsSearch"),isFeatured:(0,a.nd)("isFeatured",{mode:"boolean"}).default(!1),isActive:(0,a.nd)("isActive",{mode:"boolean"}).default(!0),createdAt:(0,i.Qq)("createdAt").default(new Date().toISOString()).notNull(),updatedAt:(0,i.Qq)("updatedAt").default(new Date().toISOString()).notNull()}),h=(0,o.r)(m),x=(0,o.aJ)(m),f=(0,s.K1)(m,({one:e})=>({category:e(d,{fields:[m.categoryId],references:[d.id]})}))}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,641,77,340,595,837,314],()=>r(73395));module.exports=s})();