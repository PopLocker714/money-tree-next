(()=>{var e={};e.id=43,e.ids=[43],e.modules={85890:e=>{"use strict";e.exports=require("better-sqlite3")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},209:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},43166:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>l,routeModule:()=>p,tree:()=>c});var a=r(49442),n=r(10042),s=r(48190),i=r.n(s),o=r(63289),d={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);r.d(t,d);let c=["",{children:["catalog",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,51689)),"/Users/jojo/Documents/Projects/money-tree-next/app/catalog/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,98158)),"/Users/jojo/Documents/Projects/money-tree-next/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,6042,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],l=["/Users/jojo/Documents/Projects/money-tree-next/app/catalog/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/catalog/page",pathname:"/catalog",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},76150:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"6000a103a66b5ccdb7be841b27e715557235634600":()=>a.yr,"6071dec3c5c63103f8be1b388af15347730bde2d1e":()=>a.k4,"6086dedfb84bed1d36d9c02de8184c830d10c433ce":()=>a.uu,"7f4b01b2f95ce1cc21ff0d237a44ebf5faf3e641b8":()=>a.n3});var a=r(88827)},62927:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,60903,23)),Promise.resolve().then(r.t.bind(r,90821,23))},48628:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,62704,23)),Promise.resolve().then(r.t.bind(r,73510,23))},51689:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m,metadata:()=>p});var a=r(47705);r(66833);var n=r(88827),s=r(23496);function i({category:e,isRoot:t}){return(0,a.jsxs)("li",{className:t?"pb-1":"pl-4 border-l border-gray-300",children:[(0,a.jsx)(s.default,{href:`/catalog?category=${e.name}`,className:"link",children:e.name}),e.children&&e.children.length>0&&(0,a.jsx)("ul",{className:"ml-4",children:e.children.map(e=>(0,a.jsx)(i,{category:e,isRoot:!1},e.id))})]})}function o({items:e}){return(0,a.jsx)("ul",{className:"pr-4",children:e.map(e=>(0,a.jsx)(i,{category:e,isRoot:!0},e.id))})}async function d(){let e=await (0,n.n3)();return(0,a.jsx)("aside",{className:"py-4",children:(0,a.jsx)(o,{items:e})})}var c=r(39145),l=r(59540),u=r(41037);let p={title:"Каталог",description:""};async function m(){await (0,l.connection)();let e=(await u.Z.query.$Products.findMany()).map(e=>({cost:e.price||0,discount:e.discount||0,title:e.title,image:e.previewImage||"/products/product-1.jpg",id:e.id?.toString()||""}));return(0,a.jsx)("section",{className:"container",children:(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(d,{}),(0,a.jsx)("div",{className:"flex-1 py-6 pl-4",children:(0,a.jsx)("div",{className:"grid grid-cols-3 gap-4",children:e.map(e=>(0,a.jsx)(c.Z,{...e},e.id))})})]})})}},88827:(e,t,r)=>{"use strict";r.d(t,{k4:()=>c,n3:()=>m,uu:()=>l,yr:()=>p});var a=r(64443);r(98356);var n=r(99069),s=r(41037),i=r(18201),o=r(91603),d=r(35413);async function c(e,t){let r=i.insertCategorySchema.safeParse({name:t.get("name"),parentId:Number(t.get("parentId"))||void 0});if(!r.success)return{error:r.error.flatten().fieldErrors};try{let e=await s.Z.insert(i.$Categories).values({name:r.data.name,parentId:r.data.parentId});return{error:null,data:e}}catch(e){return console.log(e),{error:"Something went wrong"}}}async function l(e,t){let r=Number(t.get("id"))||void 0;if(!r)return{error:"Something went wrong"};try{let e=await s.Z.delete(i.$Categories).where((0,n.eq)(i.$Categories.id,r));return{error:null,data:e}}catch(e){return console.log(e),{error:"Something went wrong"}}}let u=o.z.object({id:o.z.number(),name:o.z.string().optional(),parentId:o.z.number().optional()});async function p(e,t){let r=u.safeParse({id:Number(t.get("id")),name:t.get("name"),parentId:Number(t.get("parentId"))||void 0});if(!r.success)return{error:r.error.flatten().fieldErrors};try{let e=await s.Z.update(i.$Categories).set(r.data).where((0,n.eq)(i.$Categories.id,r.data.id));return{error:null,data:e}}catch(e){return console.log(e),{error:"Something went wrong"}}}let m=async()=>(function(e){let t={};e.forEach(e=>{t[e.id]={...e,children:[]}});let r=[];return e.forEach(e=>{null===e.parentId?r.push(t[e.id]):t[e.parentId].children.push(t[e.id])}),r})(await s.Z.query.$Categories.findMany());(0,d.h)([c,l,p,m]),(0,a.j)(c,"6071dec3c5c63103f8be1b388af15347730bde2d1e",null),(0,a.j)(l,"6086dedfb84bed1d36d9c02de8184c830d10c433ce",null),(0,a.j)(p,"6000a103a66b5ccdb7be841b27e715557235634600",null),(0,a.j)(m,"7f4b01b2f95ce1cc21ff0d237a44ebf5faf3e641b8",null)},41037:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var a=r(54797),n=r(85890),s=r.n(n),i=r(18201);let o=new(s())(process.env.DB_FILE_NAME),d=(0,a.t)({client:o,schema:i})},18201:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$Categories:()=>d,$Products:()=>u,$Users:()=>o,insertCategorySchema:()=>c,insertProductSchema:()=>p,selectCategorySchema:()=>l,selectProductSchema:()=>m});var a=r(89155),n=r(76718),s=r(20971),i=r(57670);let o=(0,a.Px)("users",{id:(0,n.e$)().primaryKey({autoIncrement:!0}),email:(0,s.fL)().notNull().unique(),password_hash:(0,s.fL)().notNull(),salt:(0,s.fL)().notNull()}),d=(0,a.Px)("categories",{id:(0,n.e$)().primaryKey({autoIncrement:!0}),name:(0,s.fL)("name").notNull(),parentId:(0,n._L)("parent_id").references(()=>d.id,{onDelete:"cascade"})}),c=(0,i.fC)(d),l=(0,i.IO)(d),u=(0,a.Px)("products",{id:(0,n._L)("id").primaryKey({autoIncrement:!0}),sku:(0,s.fL)("sku").notNull().unique(),title:(0,s.fL)("title").notNull(),description:(0,s.fL)("description"),price:(0,n._L)("price").notNull().default(0),discount:(0,n._L)("discount").default(0),stock:(0,n._L)("stock").notNull().default(0),previewImage:(0,s.fL)("previewImage"),images:(0,s.fL)("images"),categoryId:(0,n._L)("category_id").references(()=>d.id,{onDelete:"set null"}),keywordsSearch:(0,s.fL)("keywordsSearch"),isFeatured:(0,n._L)("isFeatured",{mode:"boolean"}).default(!1),isActive:(0,n._L)("isActive",{mode:"boolean"}).default(!0),createdAt:(0,s.fL)("createdAt").default(new Date().toISOString()),updatedAt:(0,s.fL)("updatedAt").default(new Date().toISOString())}),p=(0,i.fC)(u),m=(0,i.IO)(u)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[492,563,394,468,286,798],()=>r(43166));module.exports=a})();